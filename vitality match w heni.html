<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Vitality Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="vitality match w heni_files/libs/clipboard/clipboard.min.js"></script>
<script src="vitality match w heni_files/libs/quarto-html/quarto.js"></script>
<script src="vitality match w heni_files/libs/quarto-html/popper.min.js"></script>
<script src="vitality match w heni_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="vitality match w heni_files/libs/quarto-html/anchor.min.js"></script>
<link href="vitality match w heni_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="vitality match w heni_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="vitality match w heni_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="vitality match w heni_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="vitality match w heni_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Vitality Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="step-1" class="level1">
<h1>Step 1:</h1>
<p>Match LBW, mortality rates (unadjusted), and premature mortality with Heni’s dataset</p>
<p>I will complete Step 1 for LBW first since it does not require ACS data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#heni's data: </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>heni <span class="ot">=</span> haven<span class="sc">::</span><span class="fu">read_sas</span>(<span class="st">"P:/CH-Ranking/Research/model 2.0/WI vitality data/Heni/lbw_mort_wi_heni_updated_fips.sas7bdat"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#raw data </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#create a list of the files from your target directory</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path=</span><span class="st">"P:/CH-Ranking/Research/model 2.0/WI vitality data/updated data"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#initiate a blank data frame, each iteration of the loop will append the data from the given file to this variable</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>lbw <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>dth <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#had to specify columns to get rid of the total column</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(file_list)){</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  temp_file <span class="ot">=</span> file_list[i]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"lbw"</span>, temp_file, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  temp_data <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_sas</span>(<span class="fu">paste0</span>(<span class="st">"P:/CH-Ranking/Research/model 2.0/WI vitality data/updated data/"</span>, temp_file)) </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  temp_data<span class="sc">$</span>year <span class="ot">=</span> <span class="fu">substr</span>(<span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, temp_file)), <span class="dv">1</span>, <span class="fu">nchar</span>(<span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, temp_file)))<span class="sc">-</span><span class="dv">1</span>) </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  lbw <span class="ot">&lt;-</span> <span class="fu">rbind</span>(lbw, temp_data) <span class="co">#for each iteration, bind the new data to the building dataset</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  temp_data <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_sas</span>(<span class="fu">paste0</span>(<span class="st">"P:/CH-Ranking/Research/model 2.0/WI vitality data/updated data/"</span>, temp_file)) </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  temp_data<span class="sc">$</span>year <span class="ot">=</span> <span class="fu">substr</span>(<span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, temp_file)), <span class="dv">1</span>, <span class="fu">nchar</span>(<span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, temp_file)))<span class="sc">-</span><span class="dv">1</span>) </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  dth <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dth, temp_data) <span class="co">#for each iteration, bind the new data to the building dataset</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>totlbw <span class="ot">=</span> lbw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year, res_census_block) <span class="sc">%&gt;%</span> </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">totalBirth =</span> <span class="fu">sum</span>(totalBirth),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">totalLBW =</span> <span class="fu">sum</span>(totalLBW))</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(totlbw<span class="sc">$</span>totalBirth))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>totdth <span class="ot">=</span> dth <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year, res_census_block) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sumDeath =</span> <span class="fu">sum</span>(totalDeath))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>totdth <span class="ot">=</span> totdth <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(age_group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"75-79"</span>, <span class="st">"80-84"</span>, <span class="st">"85+"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, res_census_block) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="at">sumPremort =</span> <span class="fu">sum</span>(totalDeath)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(res_census_block, year, sumDeath, sumPremort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="missingness" class="level1">
<h1>Missingness</h1>
<p>Per Heni’s instructions, I expect to see missings in the LBW dataset, however I do not….. Is this a mistake on my part? Or did the data just load in R differently than it did in SAS? I also do not see evidence of special characters indicating missings</p>
<p>Number of NAs per column for each of the initial datasets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(dth))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>res_census_block        age_group       totalDeath             year 
               0                0                0                0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(lbw))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>res_census_block         totalLBW       totalBirth             year 
               0                0                0                0 </code></pre>
</div>
</div>
<p>Upon further investigation, I see that each census tract does not contain data for each year. In order to calculate cumulative sums, it is helpful to create dummy rows for these missing year and census tract combinations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>totlbw<span class="sc">$</span>year <span class="ot">=</span> <span class="fu">as.numeric</span>(totlbw<span class="sc">$</span>year)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>totdth<span class="sc">$</span>year <span class="ot">=</span> <span class="fu">as.numeric</span>(totdth<span class="sc">$</span>year)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>totlbw_c <span class="ot">=</span> totlbw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(res_census_block) <span class="sc">%&gt;%</span> <span class="fu">complete</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="dv">2012</span>, <span class="dv">2021</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(totalBirth, totalLBW) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">totalBirth =</span> <span class="fu">replace_na</span>(totalBirth, <span class="dv">0</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">totalLBW =</span> <span class="fu">replace_na</span>(totalLBW, <span class="dv">0</span>))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>totdth_c <span class="ot">=</span> totdth <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(res_census_block) <span class="sc">%&gt;%</span> <span class="fu">complete</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="dv">2012</span>, <span class="dv">2021</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(sumDeath, sumPremort) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sumDeath =</span> <span class="fu">replace_na</span>(sumDeath, <span class="dv">0</span>), </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumPremort =</span> <span class="fu">replace_na</span>(sumPremort, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There were 440 census tract and year combinations that needed to be appended to the original LBW dataset, resulting from census tracts missing data for some years.</p>
<p>There were 4029 census tract and year combinations that needed to be appended to the original DTH dataset, resulting from census tracts missing data for some years.</p>
<p>There are more observations in the mortality dataset than in the LBW dataset. This makes sense since LBW is often more missing/more private.</p>
</section>
<section id="two-special-datasets" class="level1">
<h1>Two special datasets</h1>
<p>In Heni’s instructions, she indicates that the LBW data should be grouped in 2012-2018 and 2019-2021 datasets before calculations are made… I can’t tell why this step is necessary - am I missing something?</p>
</section>
<section id="calculation-of-rolling-sums-for-lbw" class="level1">
<h1>Calculation of rolling sums for LBW</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcppRoll)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>lbw_roll <span class="ot">=</span> totlbw_c <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(res_census_block) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">twoyearBirths =</span> <span class="fu">roll_sum</span>(totalBirth, <span class="dv">2</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">threeyearBirths =</span> <span class="fu">roll_sum</span>(totalBirth, <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">fiveyearBirths =</span> <span class="fu">roll_sum</span>(totalBirth, <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sevenyearBirths =</span> <span class="fu">roll_sum</span>(totalBirth, <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">tenyearBirths =</span> <span class="fu">roll_sum</span>(totalBirth, <span class="dv">10</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">twoyearLBW =</span> <span class="fu">roll_sum</span>(totalLBW, <span class="dv">2</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">threeyearLBW =</span> <span class="fu">roll_sum</span>(totalLBW, <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">fiveyearLBW =</span> <span class="fu">roll_sum</span>(totalLBW, <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">sevenyearLBW =</span> <span class="fu">roll_sum</span>(totalLBW, <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">tenyearLBW =</span> <span class="fu">roll_sum</span>(totalLBW, <span class="dv">10</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>lbw_roll<span class="sc">$</span>twoyearLBWrate <span class="ot">=</span> lbw_roll<span class="sc">$</span>twoyearLBW<span class="sc">/</span>lbw_roll<span class="sc">$</span>twoyearBirths</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>lbw_roll<span class="sc">$</span>threeyearLBWrate <span class="ot">=</span> lbw_roll<span class="sc">$</span>threeyearLBW<span class="sc">/</span>lbw_roll<span class="sc">$</span>threeyearBirths</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>lbw_roll<span class="sc">$</span>fiveyearLBWrate <span class="ot">=</span> lbw_roll<span class="sc">$</span>fiveyearLBW<span class="sc">/</span>lbw_roll<span class="sc">$</span>fiveyearBirths</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>lbw_roll<span class="sc">$</span>sevenyearLBWrate <span class="ot">=</span> lbw_roll<span class="sc">$</span>sevenyearLBW<span class="sc">/</span>lbw_roll<span class="sc">$</span>sevenyearBirths</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>lbw_roll<span class="sc">$</span>tenyearLBWrate <span class="ot">=</span> lbw_roll<span class="sc">$</span>tenyearLBW<span class="sc">/</span>lbw_roll<span class="sc">$</span>tenyearBirths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculate-lbw-rate-by-ct-for-each-year-and-for-each-rolling-year-and-compare-to-heni" class="level1">
<h1>Calculate LBW rate by CT for each year and for each rolling year and compare to Heni</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lbw_rates <span class="ot">=</span> totlbw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(res_census_block, year) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">lbwrate =</span> totalLBW<span class="sc">/</span>totalBirth) <span class="co">#im not using the "_c" dataset because i want the "0" values to be NA when calculating </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>lbw_roll[lbw_roll<span class="sc">$</span>totalBirth <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> lbw_roll<span class="sc">$</span>totalLBW <span class="sc">!=</span> <span class="dv">0</span>,] <span class="co">#this is a check to make sure there are no rows w impossible values </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 19
# Groups:   res_census_block [0]
# ℹ 19 variables: res_census_block &lt;chr&gt;, year &lt;dbl&gt;, totalBirth &lt;dbl&gt;,
#   totalLBW &lt;dbl&gt;, twoyearBirths &lt;dbl&gt;, threeyearBirths &lt;dbl&gt;,
#   fiveyearBirths &lt;dbl&gt;, sevenyearBirths &lt;dbl&gt;, tenyearBirths &lt;dbl&gt;,
#   twoyearLBW &lt;dbl&gt;, threeyearLBW &lt;dbl&gt;, fiveyearLBW &lt;dbl&gt;,
#   sevenyearLBW &lt;dbl&gt;, tenyearLBW &lt;dbl&gt;, twoyearLBWrate &lt;dbl&gt;,
#   threeyearLBWrate &lt;dbl&gt;, fiveyearLBWrate &lt;dbl&gt;, sevenyearLBWrate &lt;dbl&gt;,
#   tenyearLBWrate &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now compare my CT rates to Heni’s CT rates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mismatch <span class="ot">=</span> lbw_rates <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>res_census_block <span class="sc">%in%</span> heni<span class="sc">$</span>res_census_block)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mismatch<span class="sc">$</span>res_census_block)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "06041113000" "06085506503" "06113010611" "08059009856" "11001004802"
 [6] "13231010300" "17007010300" "17031680500" "17031804712" "17031810200"
[11] "17097860200" "17097860813" "17111870302" "17111870814" "17201001300"
[16] "17201001500" "17201003806" "17201004003" "17201004004" "19045000400"
[21] "19065080600" "19153011304" "20061000300" "26109960200" "26109960400"
[26] "26109960500" "26109960600" "26109960700" "27137000500" "27137015800"
[31] "27153790200" "27157490500" "27163071024" "27163071300" "27169670600"
[36] "29005950100" "29021001000" "30017961300" "30045000100" "30101000100"
[41] "32007951000" "38089964000" "41029001304" "46129965100" "54025950500"
[46] "unknown"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>states <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">substr</span>(mismatch<span class="sc">$</span>res_census_block, <span class="dv">1</span>,<span class="dv">2</span>))                                </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are many GEOIDs in my data that are not included in Heni’s data (as shown above). Births from a total of 18 states are included in the data.</p>
<p>After including only the CTs that are in Heni’s dataset, Heni and I have matching rates. Note that my data does not show any missings because of the way I have chosen to structure my dataset - i.e.&nbsp;there is no 2012 column if there is no 2012 rate.</p>
<p>This is a crude check of our rates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lbwsub <span class="ot">=</span> lbw_rates <span class="sc">%&gt;%</span> <span class="fu">filter</span>(res_census_block <span class="sc">%in%</span> heni<span class="sc">$</span>res_census_block)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub<span class="sc">$</span>lbwrate[lbwsub<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2012</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.02439 0.05970 0.07163 0.10000 1.00000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>LBW_rate_2012)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   2.439   5.970   7.163  10.000 100.000      24 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub<span class="sc">$</span>lbwrate[lbwsub<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2014</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.02703 0.06250 0.06965 0.09756 1.00000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>LBW_rate_2014)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   2.703   6.250   6.965   9.756 100.000      24 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub<span class="sc">$</span>lbwrate[lbwsub<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2015</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.02500 0.05946 0.06980 0.10000 1.00000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>LBW_rate_2015)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   2.500   5.946   6.980  10.000 100.000      23 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub<span class="sc">$</span>lbwrate[lbwsub<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2017</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.02623 0.06383 0.07408 0.10714 0.50000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>LBW_rate_2017)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   2.623   6.383   7.408  10.714  50.000      25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub<span class="sc">$</span>lbwrate[lbwsub<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2019</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.02439 0.06250 0.07148 0.10256 0.66667 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>LBW_rate_2019)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   2.439   6.250   7.148  10.256  66.667      25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub<span class="sc">$</span>lbwrate[lbwsub<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2020</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.02174 0.06383 0.07304 0.10187 1.00000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>LBW_rate_2020)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   2.174   6.383   7.304  10.187 100.000      26 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub<span class="sc">$</span>lbwrate[lbwsub<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2021</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.03077 0.06667 0.07540 0.10586 1.00000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>LBW_rate_2021)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   3.077   6.667   7.540  10.586 100.000      27 </code></pre>
</div>
</div>
<p>Need to better understand how/why DHS collects this data….. Do these represent births of WI moms who may have been in another location at the time of birth? If so, maybe we still want to count them? Not sure</p>
<p>Now a crude comparison of my rolling CT rates to Heni’s rolling CT rates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>lbwsub_roll <span class="ot">=</span> lbw_roll <span class="sc">%&gt;%</span> <span class="fu">filter</span>(res_census_block <span class="sc">%in%</span> heni<span class="sc">$</span>res_census_block)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub_roll<span class="sc">$</span>threeyearLBW[lbwsub_roll<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2012</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   4.000   7.000   8.682  12.000  44.000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>threeyear_sumLBW_2012to14)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   4.000   7.000   8.681  12.000  44.000      19 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub_roll<span class="sc">$</span>fiveyearLBWrate[lbwsub_roll<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2017</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.05064 0.06897 0.07416 0.09135 0.28571 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>fiveyear_LBWrate_2017to21)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   5.068   6.897   7.418   9.121  25.688      20 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(heni<span class="sc">$</span>fiveyear_LBWrate_2017to21))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1649</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(lbwsub_roll<span class="sc">$</span>fiveyearLBWrate[lbwsub_roll<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2017</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1650</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lbwsub_roll<span class="sc">$</span>threeyearLBWrate[lbwsub_roll<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2017</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.04545 0.06897 0.07373 0.09351 0.40000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(heni<span class="sc">$</span>threeyear_LBWrate_2017to19) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   4.545   6.897   7.368   9.358  28.571      21 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(heni<span class="sc">$</span>threeyear_LBWrate_2017to19))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1648</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(lbwsub_roll<span class="sc">$</span>threeyearLBWrate[lbwsub_roll<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2017</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1650</code></pre>
</div>
</div>
<p>Some evidence of either rounding errors or mishandling of missings by either me or Heni, hard to say for sure; need to do more digging - either way, any potential differences are unsubstantial</p>
</section>
<section id="get-acs-data-for-population-estimates-to-calculate-mortality-rates" class="level1">
<h1>Get ACS data for population estimates to calculate mortality rates</h1>
<p>Whole population = male total + female = total</p>
<p>under 75 population = total - sum of all individuals older than 75</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">=</span> tidycensus<span class="sc">::</span><span class="fu">load_variables</span>(<span class="dv">2020</span>, <span class="st">"acs5"</span>, <span class="at">cache =</span> <span class="cn">TRUE</span>) <span class="co">#temp dataset to examine which vars are available thru acs without having to go to acs webpage </span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>years <span class="ot">=</span> <span class="fu">unique</span>(dth<span class="sc">$</span>year)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>allacs <span class="ot">=</span> <span class="fu">data.frame</span>() </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years)) {</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>acs <span class="ot">=</span> tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">"tract"</span>, </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">state =</span> <span class="st">"WI"</span>, </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">variables =</span> <span class="fu">c</span>(<span class="at">totpop =</span> <span class="st">"B01001_001"</span>, </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">m85pop =</span> <span class="st">"B01001_025"</span>,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">m80pop =</span> <span class="st">"B01001_024"</span>, </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">m75pop =</span> <span class="st">"B01001_023"</span>,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">mtot =</span> <span class="st">"B01001_002"</span>,</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">ftot =</span> <span class="st">"B01001_026"</span>, </span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">f75pop =</span> <span class="st">"B01001_047"</span>,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">f80pop =</span> <span class="st">"B01001_048"</span>,</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">f85pop =</span> <span class="st">"B01001_049"</span>), </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">year =</span> <span class="fu">as.numeric</span>(years[i]))</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>acs<span class="sc">$</span>year <span class="ot">=</span> years[i]</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>allacs <span class="ot">=</span> <span class="fu">rbind</span>(acs, allacs)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>acsw <span class="ot">=</span> <span class="fu">pivot_wider</span>(allacs, <span class="at">id_cols =</span> <span class="fu">c</span>(GEOID,year), <span class="at">names_from =</span> variable, <span class="at">values_from =</span> estimate)</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> acsw<span class="sc">$</span>totpop <span class="sc">-</span> (acsw<span class="sc">$</span>ftot <span class="sc">+</span> acsw<span class="sc">$</span>mtot) <span class="co">#confirmation that ftot + mtot = totpop </span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>pops <span class="ot">=</span> acsw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(GEOID, year) <span class="sc">%&gt;%</span> </span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sub75 =</span> totpop <span class="sc">-</span> m85pop <span class="sc">-</span> m80pop <span class="sc">-</span> m75pop</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span> f85pop <span class="sc">-</span> f80pop <span class="sc">-</span> f75pop) <span class="sc">%&gt;%</span> </span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(totpop, sub75, GEOID, year) </span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>pops<span class="sc">$</span>statecode <span class="ot">=</span> <span class="fu">substr</span>(pops<span class="sc">$</span>GEOID, <span class="dv">1</span>,<span class="dv">2</span>) </span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>pops<span class="sc">$</span>countycode <span class="ot">=</span> <span class="fu">substr</span>(pops<span class="sc">$</span>GEOID, <span class="dv">3</span>,<span class="dv">5</span>)</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>pops<span class="sc">$</span>tract <span class="ot">=</span> <span class="fu">substr</span>(pops<span class="sc">$</span>GEOID, <span class="dv">6</span>, <span class="fu">nchar</span>(pops<span class="sc">$</span>GEOID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merge-pops-with-dhs-data" class="level1">
<h1>Merge Pops with DHS data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>dthpop <span class="ot">=</span> <span class="fu">merge</span>(totdth, pops, <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"res_census_block"</span>, <span class="st">"year"</span>), <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculation-of-rolling-sums-for-mortality-and-premortality" class="level1">
<h1>Calculation of rolling sums for Mortality and Premortality</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcppRoll)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>dth_roll <span class="ot">=</span> totdth_c <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(res_census_block) <span class="sc">%&gt;%</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">twoyeardeath =</span> <span class="fu">roll_sum</span>(sumDeath, <span class="dv">2</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">threeyeardeath =</span> <span class="fu">roll_sum</span>(sumDeath, <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">fiveyeardeath =</span> <span class="fu">roll_sum</span>(sumDeath, <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sevenyeardeath =</span> <span class="fu">roll_sum</span>(sumDeath, <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">tenyeardeath =</span> <span class="fu">roll_sum</span>(sumDeath, <span class="dv">10</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">twoyearPremort =</span> <span class="fu">roll_sum</span>(sumPremort, <span class="dv">2</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">threeyearPremort =</span> <span class="fu">roll_sum</span>(sumPremort, <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">fiveyearPremort =</span> <span class="fu">roll_sum</span>(sumPremort, <span class="dv">5</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">sevenyearPremort =</span> <span class="fu">roll_sum</span>(sumPremort, <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>),</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">tenyearPremort =</span> <span class="fu">roll_sum</span>(sumPremort, <span class="dv">10</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculation-of-mortality-and-premortality-rates-for-each-ct" class="level1">
<h1>Calculation of Mortality and Premortality Rates for each CT</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>dth_rates <span class="ot">=</span> totdth <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(res_census_block, year) <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dthrate =</span> sumDeath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Questions for the group: what are the rolling averages for? I understand the five year ones (For use w ACS data) but I do not yet understand the need for two and three year rolling averages</p>
<p>What is the intention with the ACS five year estimates? Do we divide by 5 to get an approximate population for each single year?</p>
<p>How does DHS decide which births get counted? There are births from 18 different states in the data from DHS</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>